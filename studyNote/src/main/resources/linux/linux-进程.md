# 进程
* 进程&程序
    * 进程
        * 运行着的程序，有pid是与程序的主要区别
    * 程序
        * 是一段代码
* 进程-PCB
    * linux操作系统在运行一个程序时，会虚拟0-4G地址空间
        * 0-3G是用户空间，每个进程单独占有
        * 3G-4G是内核空间，多个进程共享
    * linux操作系统为管理进程，会为每个进程创建一个PCB(process control block)
        * PCB数据保存在内核空间
        * 保存的数据有
            * PID
            * 进程状态
            * 进程切换时需要保存/恢复的cpu寄存器
* linux-进程切换:  
    * cpu运行多进程采用了分时复用的原则，看起来像并行，但实际在某个时间点，一个cpu只在运行一个进程
    > 如果是单核cpu，只能运行一个线程
    * cpu架构
        * 预取器
            * 从内存中获取机器指令
        * 译码器
            * 解析机器指令
        * 运算器
            * 对指令设计的寄存器中的数值进行计算
            * 支持加法、减法、位移
        * 寄存器
            * 数据暂存的地方
        * 执行顺序
            * 预取器从内存中获取指令->译码器解释指令->运算器从寄存器中取值运算再写回到寄存器中
    * 每次进程切换的时候，要将当前寄存器中的内容，保存到当前进程的PCB中;从被调度的PCB中，取出寄存器的内容，恢复现场
    > 当频繁进程切换的时候，cpu浪费在寄存器恢复/保存上的时间越来越长，浪费明显  
    执行vmstat 1 100，注意观察cs的值
* cpu/多核/多cpu/超线程
    * cpu
        * 主频代表cpu一秒能执行的指令个数，越大效率越高
        * 做为用电器，主频越大，功率越大，发热越多，当风冷无法满足的时候，基本就是极限了。(水冷)
    * 单核-多核
        * 当cpu以提升主频达到瓶颈的时候，开始考虑多核
        * 多核可以提升效率的同时，降低功率和发热
    * 进程-线程
        * 进程做为资源的拥有者，在创建/撤销/切换等场景下，时间/空间的开销都太巨大，总体来说较为重量级
        * 线程做为一个轻量级的产物诞生，不作为资源的占有者，但是可以被os调度
    * 线程切换 vs 进程切换
        * 当进程切换的时候，整个cpu中的内容都将被保存，写入pcb，然后再加载新的进程pcb中记录的信息
        * 当同一个进程的不同线程切换的时候，由于线程间共享一些数据，所以在一个cpu上切换的时候，替换的资源较少，开销较小
        * 多核cpu
            * 将多个cpu集成到一个cpu中|一个cpu拥有多个完整的计算核心，以上是俩种常见的说法
            * cpu不仅有计算核心，还有缓存，总线等资源
            * 当一个cpu有多核的时候，就可以真正的并发执行多个线程，且缓存等资源是俩个线程共享的，此时效率会提升很多
    * 超线程
        * 在单个核心中，增加逻辑组件，来达到一个核心，运行多个线程
            * 增加组件的代价要远小于增加一个核心，但能明显提升单核的效率
        * 理论依据，多个线程在某个时刻，访问的核心中不同的组件，此时线程之间无依赖关系，就可以并发执行
* fork
    * 创建子进程，其他资源使用了读时共享，写时复制的原则
    * fork子进程，从调用fork开始，该方法被调用一次，但返回俩次。在父进程中返回子进程pid，在子进程中返回0。(如果出错，返回负值)
    * 可以通过返回值，继续执行不同的代码
    * shell命令执行就是利用了fork+exec+前后台作业的方式实现
* exec族函数
    * exec在执行行，会加载目标命令的代码段数据段到当前程序中
    * 写在exec函数后面的代码不会被执行
    * exec经常与fork函数结合使用，先fork子进程，然后用新的命令替换子进程的代码段/数据段
    > 补充fork:由于fork之后，一般不再继续执行父进程中的代码，所以现代的os再fork的时候，采用了读时共享，写时复制的策略
*  参考资料
    * [多核](https://baike.baidu.com/item/%E5%A4%9A%E6%A0%B8%E5%A4%84%E7%90%86%E5%99%A8/10278420?fr=aladdin)
    * [猿码道](https://www.jianshu.com/p/5549e89133d2)
    * [linux虚拟内存](https://blog.csdn.net/ZYZMZM_/article/details/87893543)