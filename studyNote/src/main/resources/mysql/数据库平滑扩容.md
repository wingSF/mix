# 数据库平滑扩容
* 参考文档
    * [参考文档1](https://mp.weixin.qq.com/s/b_67F3UZ2MYuQFmS8QhGaA) 
    * [参考文档2](https://mp.weixin.qq.com/s/1ZswtROH32_SuaJxeg-vKw)
    * 以上俩篇文档都来自58沈剑，讲述的议题是数据库扩容时，如何做到不停机的平滑扩容方案
        * 第一篇讲述如何使用双主实现双倍水平扩容
        * 第二篇讲述的更加宽泛，可实现跨存储介质的迁移方案
        * 第一篇的实质是第二篇具体实现，这种实现，更加适合双主架构的高可用mysql集群
    
* 自己总结
    * 水平扩容思路
        * 场景:当前只有实例a提供服务，新加入实例b，做到数据分片
            * 日志追加方案
                * 自研程序，将其他实例中的数据，按照即将更新的路由规则检索数据
                * 把这些数据写入到即将加入的实例中
                * 同时同步对这些数据的增加改等操作(通过日志实现)
                * 等到数据同步到可以接受的程度，更新分片规则
                * 做冗余数据清理
            * 双写方案
                * 将数据写入和更新操作，按照新的路由规则，写一份数据到新的实例中
                * 同时启动程序，将别的实例中，按照新的路由规则，把属于新实例的数据写到新实例中
                * 等到数据追平的时候，新的实例可以对外提供服务，路由规则可以更新
                * 做冗余数据清理
    * 针对文档1做一次详细的描述
        * 假设当前有数据库实例a，b，路由规则是%2==0|1
        * 同时存在a1，b1俩个数据库，作为a，b的备份库，数据与a，b一致，当a，b发生故障时，可自动迁移(高可用的一种保证方式)
        * 修改路由规则 %4==0|1|2|3，对应顺序 a，a1，b，b1，注意此时数据访问是不会有问题的
        * 此时就实现了俩个实例a，b扩容为四个实例a，b，c，d
        * 为新的四个实例，增加备份，等待下次扩容
        * 此时，扩容确实已经完成了，剩余的工作，就是数据清理
        * 假设数据没有写入，a与b的数据一致，c与d的数据一致，在采用了新的分片规则后，在a中%4==1的数据将再也不会被访问到，可以删除，同理推广到剩余的三个库
        * 在完成数据清理之后，扩容过程就完成了，此时每个实例的数据量，确实达到了下降，实现了扩容降低访问压力的目标
        
                 